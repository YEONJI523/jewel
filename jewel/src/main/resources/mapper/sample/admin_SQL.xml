<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="admin">
	<select id="selectitemList" parameterType="hashmap" resultType="hashmap">
			SELECT 
				ITEM_NUM,ITEM_TYPE,ITEM_NAME,ITEM_PRICE,ITEM_DCP,ITEM_IMAGE1,ITEM_IMAGE2,ITEM_DATE,ITEM_STOCK
			FROM 
				ITEM	
	</select>
	
	<select id="selectItemDetail" parameterType="hashmap" resultType="hashmap">
			SELECT 
				ITEM_NUM,ITEM_TYPE,ITEM_NAME,ITEM_PRICE,ITEM_DCP,ITEM_IMAGE1,ITEM_IMAGE2,ITEM_DATE,ITEM_STOCK
			FROM 
				ITEM
			WHERE 
				ITEM_NUM=#{ITEM_NUM}
	</select>
	
	<insert id="insertItemWrite" parameterType="hashmap" >
		INSERT INTO ITEM 
			VALUES((SELECT #{ITEM_TYPE} || LPAD(MAX(to_number(LTRIM(SUBSTR(ITEM_NUM,2,3),0)))+1,3,0) 
						FROM ITEM WHERE ITEM_TYPE=#{ITEM_TYPE})
			,#{ITEM_TYPE},#{ITEM_NAME},#{ITEM_PRICE},#{ITEM_DCP},#{ITEM_IMAGE1},#{ITEM_IMAGE2},SYSDATE,#{ITEM_STOCK} )
	 
	</insert>
	<update id="updateItemModify" parameterType="hashmap">
	UPDATE ITEM 
		SET ITEM_NAME=#{ITEM_NAME},ITEM_PRICE=#{ITEM_PRICE},ITEM_DCP=#{ITEM_DCP},ITEM_IMAGE1=#{ITEM_IMAGE1},ITEM_IMAGE2=#{ITEM_IMAGE2},ITEM_DATE=SYSDATE,ITEM_STOCK=#{ITEM_STOCK}
 	WHERE ITEM_NUM=#{ITEM_NUM}
  
	</update>
	<update id="deleteItem" parameterType="hashmap">
	DELETE 
		FROM ITEM 
		WHERE ITEM_NUM=#{ITEM_NUM}
	
	</update>
	<select id="selectQnAList" parameterType="hashmap" resultType="hashmap">
		SELECT  QNA_NUM,MEM_ID,CASE WHEN LENGTH(QNA_TITLE)>=10 THEN SUBSTR(QNA_TITLE,1,10)||'...' ELSE QNA_TITLE END QNA_TITLE,QNA_DATE,QNA_RTITLE,QNA_RCONTENT,QNA_RDATE,QNA_RSTATE,QNA_PWD,ITEM_NUM,QNA_CATE
    FROM QNA
		ORDER BY
			 QNA_RSTATE,QNA_DATE
	</select>
	
	<select id="selectQnADetail" parameterType="hashmap" resultType="hashmap">
			SELECT  
				QNA_NUM,MEM_ID,QNA_TITLE,QNA_CONTENT,QNA_DATE,QNA_RTITLE,QNA_RCONTENT,QNA_RDATE,QNA_RSTATE,QNA_PWD,ITEM_NUM,QNA_CATE,QNA_NAME
			FROM 
				QnA
			WHERE 
				QNA_NUM=#{QNA_NUM}
	</select>
	
	
	<update id="qnaReply" parameterType="hashmap">
		UPDATE 
			QNA 
		SET 
			QNA_RTITLE=#{QNA_RTITLE}, QNA_RCONTENT=#{QNA_RCONTENT}, QNA_RDATE=SYSDATE, QNA_RSTATE='Y' 
		WHERE 
			QNA_NUM=#{QNA_NUM}
  
	</update>
	<update id="qnaReplyDelete" parameterType="hashmap">
		UPDATE 
			QNA
		 SET 
		 	QNA_RTITLE='', QNA_RCONTENT='', QNA_RDATE='', QNA_RSTATE='N'
		 WHERE 
		 	QNA_NUM=#{QNA_NUM}
	
	</update>
	<update id="deleteQnA" parameterType="hashmap">
	DELETE FROM QNA 
		WHERE QNA_NUM=#{QNA_NUM}
	
	</update>
	<select id="selectDaySaleList" parameterType="hashmap" resultType="hashmap">
	SELECT O.ITEM_NUM,i.item_name  AS ITEM_NAME,SUM(O.OR_CNT) as CNT  FROM ORDERS O,ITEM I WHERE OR_DATE=#{OR_DATE} AND O.ITEM_NUM=I.ITEM_NUM
GROUP BY O.ITEM_NUM,I.ITEM_NAME order by CNT desc
	</select>
	<select id="selectMonthSaleList" parameterType="hashmap" resultType="hashmap">
	SELECT O.ITEM_NUM,I.ITEM_NAME AS ITEM_NAME,SUM(O.OR_CNT) as cnt  FROM ORDERS O,ITEM I
WHERE TO_CHAR(OR_DATE,'YYYY-MM')=#{OR_DATE}  AND  O.ITEM_NUM=I.ITEM_NUM
GROUP BY O.ITEM_NUM,I.ITEM_NAME order by CNT desc
	</select>
	<select id="selectCateDaySaleList" parameterType="hashmap" resultType="hashmap">
		SELECT SUBSTR(ITEM_NUM,1,1) CATEGORY,SUM(OR_CNT) CNT  FROM ORDERS WHERE TO_CHAR(OR_DATE,'YYYY-MM-DD')=#{OR_DATE}
GROUP BY SUBSTR(ITEM_NUM,1,1) order by CNT desc
	</select>
	<select id="selectCateMonthSaleList" parameterType="hashmap" resultType="hashmap">
SELECT SUBSTR(ITEM_NUM,1,1) CATEGORY,SUM(OR_CNT) CNT  FROM ORDERS WHERE TO_CHAR(OR_DATE,'YYYY-MM')=#{OR_DATE}
GROUP BY SUBSTR(ITEM_NUM,1,1) order by CNT desc
	</select>
</mapper>